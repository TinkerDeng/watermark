!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WaterMask=e()}(this,function(){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t};function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i={id:"test-xxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),text:"初始化水印文字",font:"20px Times New Roman",rotateDegree:30*Math.PI/180,width:200,height:200,preventTamper:!1,style:{position:"fixed",top:0,left:0,"pointer-events":"none",width:"100%",height:"100%","z-index":1e3}};function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e(this,o),this.container=null,this.backgroundUrl=null,this.opts=n({},i,t)}return t(o,[{key:"init",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};this.opts=n({},this.opts,e),this.container=this.createContainer(),this.opts.preventTamper&&this.initObserve(!0)}},{key:"createImageUrl",value:function(){var t=this.opts,e=document.createElement("canvas"),n=t.text;e.width=t.width,e.height=t.height;var r=e.getContext("2d");return r.shadowOffsetX=2,r.shadowOffsetY=2,r.shadowBlur=2,r.shadowColor="rgba(0, 0, 0, 0.5)",r.font=t.font,r.fillStyle="rgba(0,0,0,0.1)",r.rotate(t.rotateDegree),r.translate(t.trax,t.tray),r.textAlign="left",r.fillText(n,35,32),e.toDataURL("image/png")}},{key:"createContainer",value:function(t){var e=this.opts,n=document.getElementById(e.id);if(!t&&n)return this.container;var r=this.createImageUrl(),i=n||document.createElement("div");i.id=e.id;var o=!e.preventTamper&&e.parentEl||document.body;"string"==typeof o&&o.startsWith("#")&&(o=o.substring(1),o=document.getElementById(o));var a=o.getBoundingClientRect();return e.style.left=(e.left||a.left)+"px",e.style.top=(e.top||a.top)+"px",i.style.cssText=this.getStyleText(e),i.setAttribute("class",""),this.backgroundUrl="url("+r+") repeat top left",i.style.background=this.backgroundUrl,n||o.appendChild(i),i}},{key:"getStyleText",value:function(){var e="",n=this.opts.style;return Object.keys(n).forEach(function(t){e+=t+": "+n[t]+";"}),e}},{key:"initObserve",value:function(){var t,e,n,r=this,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;i?(t={attributes:!0,childList:!0,characterData:!0,subtree:!0},e=this.container,(n=new i(function(){n.disconnect(),r.container=r.createContainer(!0),n.observe(e,t)})).observe(e,t)):console.log("不支持 MutationObserver")}}]),o});
